import{s as B,r as p,c as S,o as R,d as r,a as E,w as T,b as M,u as $,f as u,g as e,k as d,l as j,t as a,h as n,F as _,m as y,q as k,v as c,j as F,I as N}from"./index-CfG8UM58.js";const O={class:"max-w-6xl mx-auto p-6 bg-white rounded shadow"},q={class:"flex justify-between items-center mb-6"},A={class:"text-xl font-semibold"},L={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},z=["value"],G={key:0,class:"mb-6"},H={class:"border rounded p-3 max-h-48 overflow-auto"},J=["value"],K={class:"w-full text-sm border mb-4"},Q=["onUpdate:modelValue"],W=["onUpdate:modelValue"],X=["onUpdate:modelValue"],Y=["onUpdate:modelValue"],Z={class:"text-right font-medium"},ee=["onClick"],te={class:"text-right text-lg font-semibold"},le={__name:"ProformaEdit",setup(se){const v=B(),D=$(),b=!!v.params.id,x=p([]),f=p([]),g=p([]),o=p({customer_id:"",invoice_date:new Date().toISOString().slice(0,10),due_date:"",currency:"USD",items:[]}),U=S(()=>o.value.currency==="USD"?"$":o.value.currency==="EUR"?"€":"Rf"),V=()=>{o.value.items.push({description:"",unit_price:0,units:1,unit_type:"per_booking"})},w=l=>o.value.items.splice(l,1),h=l=>l.unit_price*l.units,C=S(()=>o.value.items.reduce((l,t)=>l+h(t),0));R(async()=>{if(x.value=(await r.get("customers")).data,V(),b){const l=await r.get(`proformas/${v.params.id}`);Object.assign(o.value,l.data)}});const I=async()=>{const l=await r.get("bookings/without-proforma",{params:{customer_id:o.value.customer_id}});f.value=l.data},P=async()=>{const l={...o.value,bookings:g.value,total:C.value};b?await r.put(`proformas/${v.params.id}`,l):await r.post("proformas",l),D.push("/proformas")};return(l,t)=>(u(),E(M,null,{default:T(()=>[e("div",O,[e("div",q,[e("h2",A,a(b?"Edit Proforma Invoice":"Create Proforma Invoice"),1)]),e("div",L,[e("div",null,[t[6]||(t[6]=e("label",{class:"block font-medium mb-1"},"Customer *",-1)),n(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>o.value.customer_id=s),class:"input",onChange:I},[t[5]||(t[5]=e("option",{disabled:"",value:""},"Select a customer",-1)),(u(!0),d(_,null,y(x.value,s=>(u(),d("option",{key:s.id,value:s.id},a(s.name),9,z))),128))],544),[[k,o.value.customer_id]])]),e("div",null,[t[7]||(t[7]=e("label",{class:"block font-medium mb-1"},"Invoice Date *",-1)),n(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=s=>o.value.invoice_date=s),class:"input"},null,512),[[c,o.value.invoice_date]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"block font-medium mb-1"},"Due Date",-1)),n(e("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=s=>o.value.due_date=s),class:"input"},null,512),[[c,o.value.due_date]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block font-medium mb-1"},"Currency",-1)),n(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>o.value.currency=s),class:"input"},t[9]||(t[9]=[e("option",{value:"USD"},"USD",-1),e("option",{value:"MVR"},"MVR",-1),e("option",{value:"EUR"},"EUR",-1)]),512),[[k,o.value.currency]])])]),f.value.length?(u(),d("div",G,[t[11]||(t[11]=e("h3",{class:"font-semibold mb-2"},"Select Bookings",-1)),e("div",H,[(u(!0),d(_,null,y(f.value,s=>(u(),d("label",{key:s.id,class:"flex items-center gap-2 text-sm mb-1"},[n(e("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=m=>g.value=m),value:s},null,8,J),[[N,g.value]]),F(" "+a(s.reference)+" | "+a(s.check_in)+" → "+a(s.check_out),1)]))),128))])])):j("",!0),t[14]||(t[14]=e("h3",{class:"font-semibold mb-2"},"Invoice Particulars",-1)),e("table",K,[t[13]||(t[13]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"p-2"},"Description"),e("th",{class:"p-2"},"Unit Price"),e("th",{class:"p-2"},"Units"),e("th",{class:"p-2"},"Unit Type"),e("th",{class:"p-2"},"Total"),e("th")])],-1)),e("tbody",null,[(u(!0),d(_,null,y(o.value.items,(s,m)=>(u(),d("tr",{key:m},[e("td",null,[n(e("input",{"onUpdate:modelValue":i=>s.description=i,class:"input"},null,8,Q),[[c,s.description]])]),e("td",null,[n(e("input",{type:"number","onUpdate:modelValue":i=>s.unit_price=i,class:"input"},null,8,W),[[c,s.unit_price,void 0,{number:!0}]])]),e("td",null,[n(e("input",{type:"number","onUpdate:modelValue":i=>s.units=i,class:"input"},null,8,X),[[c,s.units,void 0,{number:!0}]])]),e("td",null,[n(e("select",{"onUpdate:modelValue":i=>s.unit_type=i,class:"input"},t[12]||(t[12]=[e("option",{value:"night"},"Per Night",-1),e("option",{value:"booking"},"Per Booking",-1),e("option",{value:"pax"},"Per Pax",-1)]),8,Y),[[k,s.unit_type]])]),e("td",Z,a(U.value)+" "+a(h(s).toFixed(2)),1),e("td",null,[e("button",{onClick:i=>w(m),class:"text-red-600"},"✕",8,ee)])]))),128))])]),e("button",{onClick:V,class:"text-blue-600 mb-4"}," + Add Particular "),e("div",te," Total: "+a(U.value)+" "+a(C.value.toFixed(2)),1),e("div",{class:"flex justify-end gap-3 mt-6"},[e("button",{onClick:P,class:"bg-blue-600 text-white px-6 py-2 rounded"}," Save Invoice ")])])]),_:1}))}};export{le as default};
