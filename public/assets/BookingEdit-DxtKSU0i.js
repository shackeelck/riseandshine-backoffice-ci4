import{_ as ee,s as le,r as i,c as B,o as te,d as f,C as oe,a as ae,w as se,b as ue,u as ie,f as u,g as l,p as ne,k as n,l as _,h as s,F as U,m as q,t as b,q as D,v as r,j,I as de,i as O,H as Y}from"./index-CfG8UM58.js";import{d as A,s as H}from"./dayjs.min-DOsEsJbi.js";import"./_commonjsHelpers-DsqdWQfm.js";const re={class:"p-6 max-w-4xl mx-auto bg-white shadow rounded-lg"},ve={class:"grid grid-cols-1 md:grid-cols-6 gap-4"},me={class:"md:col-span-2"},pe=["value"],fe={key:0,class:"text-sm text-gray-600 mt-10"},ce={class:"font-medium"},be={key:0},ye={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ke={class:"md:col-span-2"},_e=["value"],ge=["value"],xe={class:"md:col-end-5"},Ve={key:0,class:"text-sm mb-2"},we={key:0,class:"text-green-600"},Ce={key:1,class:"text-red-600"},Ue={key:1,class:"flex items-center mb-4"},qe={key:2,class:"text-blue-600 text-sm mb-2"},De={key:3,class:"text-red-600 mb-4"},Re={class:"grid gap-4 md:grid-cols-3 mb-2"},he=["onUpdate:modelValue"],Ne=["onUpdate:modelValue"],Ge=["onUpdate:modelValue"],Se=["onClick"],Be={class:"grid md:grid-cols-3 gap-4"},Ae={class:"flex justify-end"},Fe=["disabled"],Ie={__name:"BookingEdit",setup(Me){const z=le(),L=ie(),g=z.params.id,F=i([]),I=i([]),R=i([]);A().format("YYYY-MM-DD");const h=B(()=>!o.value.check_in||!o.value.check_out?0:A(o.value.check_out).diff(A(o.value.check_in),"day")),N=i([]),V=i(!1),Z=async(v="")=>{V.value=!0;try{const e=await f.get("countries",{params:{q:v}});N.value=(e.data||[]).map(t=>({value:Number(t.id),label:t.name}))}finally{V.value=!1}},o=i({customer_id:"",customer_ref_no:"",room_type_id:"",check_in:"",check_out:"",guests:1,status:"pending",arrival_flight:"",departure_flight:"",room_inventory_id:null,special_request:""}),d=i({name:"",contact:"",email:"",id_proof:"",dob:""}),x=i([]),p=i(""),w=i(!1),c=i(null),y=i(!1),k=i(!1),M=i(null),P=i(null),$=i(null),G=B(()=>S()),J=B(()=>w.value?!0:G.value?y.value&&c.value<1&&!k.value:!1);te(async()=>{const[v,e,t,C]=await Promise.all([f.get("customers"),f.get("roomtypes"),f.get(`currentinventory/${g}`),f.get(`bookings/${g}`)]);await Z(),F.value=v.data,I.value=e.data,R.value=t.data;const a=C.data;o.value={customer_id:a.customer_id,customer_ref_no:a.customer_ref_no??"",room_type_id:a.room_type_id,check_in:a.check_in,check_out:a.check_out,guests:a.guests,status:a.status,arrival_flight:a.arrival_flight,departure_flight:a.departure_flight,room_inventory_id:a.room_inventory_id,special_request:a.special_request??""},M.value=a.room_type_id,P.value=a.check_in,$.value=a.check_out;const T=(await f.get(`bookings/${g}/guests`)).data||[];d.value=T.find(m=>m.is_primary==="1")||{name:"",contact:"",email:"",id_proof:"",dob:"",nationality_id:null},x.value=T.filter(m=>m.is_primary==="0").map(m=>({name:m.name,contact:m.contact,email:m.email,id_proof:m.id_proof,dob:m.dob,nationality_id:m.nationality_id}))});const S=()=>o.value.room_type_id!==M.value||o.value.check_in!==P.value||o.value.check_out!==$.value,K=()=>x.value.push({name:"",contact:"",email:"",id_proof:"",dob:""}),Q=v=>x.value.splice(v,1),W=()=>!o.value.customer_id||!o.value.room_type_id||!o.value.check_in||!o.value.check_out?(p.value="Please fill all required fields.",!1):new Date(o.value.check_out)<=new Date(o.value.check_in)?(p.value="Check-out must be after check-in.",!1):d.value.name?!0:(p.value="Primary guest details are required.",!1);oe(()=>[o.value.room_type_id,o.value.check_in,o.value.check_out],async()=>{if(!S()){y.value=!1,k.value=!1;return}o.value.room_type_id&&o.value.check_in&&o.value.check_out&&new Date(o.value.check_out)>new Date(o.value.check_in)&&await E()});const E=async()=>{w.value=!0;try{const{data:v}=await f.get("availability/check",{params:{room_type_id:o.value.room_type_id,check_in:o.value.check_in,check_out:o.value.check_out,exclude_booking_id:g}});c.value=v.available_rooms,R.value=v.available_inventory,y.value=!0}catch{c.value=0,y.value=!0}finally{w.value=!1}},X=async()=>{if(p.value="",!W())return;if(S()&&(await E(),c.value<1&&!k.value)){p.value="Selected room category is not available for these dates.";return}const v={...o.value,inventory_id:o.value.room_inventory_id,primaryGuest:d.value,extraGuests:x.value,overbook:k.value};try{const e=await f.put(`bookings/${g}`,v);e.data.status==="success"?L.push("/bookings"):p.value=e.data.message||"Update failed."}catch{p.value="Server error."}};return(v,e)=>(u(),ae(ue,null,{default:se(()=>[l("div",re,[e[50]||(e[50]=l("h2",{class:"text-xl font-semibold mb-6 border-b pb-2"},"Edit Booking & Guest Details",-1)),l("form",{onSubmit:ne(X,["prevent"]),class:"space-y-6 p-3 rounded-xl"},[l("div",ve,[l("div",me,[e[20]||(e[20]=l("label",{class:"block font-medium mb-1"},"Customer/Agent *",-1)),s(l("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.value.customer_id=t),class:"input-field",required:""},[e[19]||(e[19]=l("option",{disabled:"",value:""},"Select a customer",-1)),(u(!0),n(U,null,q(F.value,t=>(u(),n("option",{key:t.id,value:t.id},b(t.name),9,pe))),128))],512),[[D,o.value.customer_id]])]),l("div",null,[e[21]||(e[21]=l("label",{class:"block font-medium mb-1"},"Customer Ref No",-1)),s(l("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>o.value.customer_ref_no=t),type:"text",class:"input-field",placeholder:"Customer / Agent reference number"},null,512),[[r,o.value.customer_ref_no]])]),l("div",null,[e[22]||(e[22]=l("label",{class:"block font-medium mb-1"},"Check-In *",-1)),s(l("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.value.check_in=t),type:"date",class:"input-field",required:""},null,512),[[r,o.value.check_in]])]),l("div",null,[e[23]||(e[23]=l("label",{class:"block font-medium mb-1"},"Check-Out *",-1)),s(l("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.check_out=t),type:"date",class:"input-field",required:""},null,512),[[r,o.value.check_out]])]),h.value>0?(u(),n("div",fe,[e[24]||(e[24]=j(" üõèÔ∏è ")),l("span",ce,b(h.value),1),e[25]||(e[25]=j(" Night")),h.value>1?(u(),n("span",be,"s")):_("",!0)])):_("",!0)]),l("div",ye,[l("div",ke,[e[27]||(e[27]=l("label",{class:"block font-medium mb-1"},"Room Type *",-1)),s(l("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.room_type_id=t),class:"input-field",required:""},[e[26]||(e[26]=l("option",{disabled:"",value:""},"Select a room type",-1)),(u(!0),n(U,null,q(I.value,t=>(u(),n("option",{key:t.id,value:t.id},b(t.name),9,_e))),128))],512),[[D,o.value.room_type_id]])]),l("div",null,[e[29]||(e[29]=l("label",{class:"block font-medium mb-1"},"Select Room",-1)),s(l("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.room_inventory_id=t),class:"input-field"},[e[28]||(e[28]=l("option",{disabled:"",value:""},"Select available room",-1)),(u(!0),n(U,null,q(R.value,t=>(u(),n("option",{key:t.id,value:t.id},b(t.room_number)+" (Floor "+b(t.floor)+" ) ",9,ge))),128))],512),[[D,o.value.room_inventory_id]])]),l("div",xe,[e[30]||(e[30]=l("label",{class:"block font-medium mb-1"},"No of Guests",-1)),s(l("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.guests=t),type:"number",min:"1",class:"input-field"},null,512),[[r,o.value.guests,void 0,{number:!0}]])])]),G.value&&y.value?(u(),n("div",Ve,[c.value>0?(u(),n("span",we," ‚úîÔ∏è "+b(c.value)+" room(s) available ",1)):(u(),n("span",Ce," ‚ö†Ô∏è No rooms available for these dates. "))])):_("",!0),G.value&&y.value&&c.value<1?(u(),n("div",Ue,[s(l("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=t=>k.value=t),class:"mr-2",id:"overbook"},null,512),[[de,k.value]]),e[31]||(e[31]=l("label",{for:"overbook",class:"text-gray-700"},"Confirm allowing overbooking",-1))])):_("",!0),w.value?(u(),n("div",qe," Checking availability... ")):_("",!0),p.value?(u(),n("p",De,b(p.value),1)):_("",!0),l("div",null,[e[38]||(e[38]=l("h3",{class:"font-semibold mb-2"},"Primary Guest Details",-1)),l("div",Re,[l("div",null,[e[32]||(e[32]=l("label",null,"Full Name *",-1)),s(l("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>d.value.name=t),class:"input-field",required:""},null,512),[[r,d.value.name]])]),l("div",null,[e[33]||(e[33]=l("label",null,"Contact ",-1)),s(l("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>d.value.contact=t),class:"input-field"},null,512),[[r,d.value.contact]])]),l("div",null,[e[34]||(e[34]=l("label",null,"Email",-1)),s(l("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>d.value.email=t),class:"input-field"},null,512),[[r,d.value.email]])]),l("div",null,[e[35]||(e[35]=l("label",null,"ID/Passport No",-1)),s(l("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>d.value.id_proof=t),class:"input-field"},null,512),[[r,d.value.id_proof]])]),l("div",null,[e[36]||(e[36]=l("label",null,"Date Of Birth",-1)),s(l("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>d.value.dob=t),type:"date",class:"input-field"},null,512),[[r,d.value.dob]])]),l("div",null,[e[37]||(e[37]=l("label",null,"Nationality",-1)),O(Y(H),{modelValue:d.value.nationality_id,"onUpdate:modelValue":e[13]||(e[13]=t=>d.value.nationality_id=t),options:N.value,searchable:!0,loading:V.value,placeholder:"Country",class:"multiselect"},null,8,["modelValue","options","loading"])])])]),l("div",null,[e[44]||(e[44]=l("h3",{class:"font-semibold mb-2"},"Additional Guests",-1)),(u(!0),n(U,null,q(x.value,(t,C)=>(u(),n("div",{key:C,class:"grid gap-4 md:grid-cols-[2fr_2fr_1fr_2fr] items-end mb-4"},[l("div",null,[e[39]||(e[39]=l("label",null,"Name",-1)),s(l("input",{"onUpdate:modelValue":a=>t.name=a,class:"input-field"},null,8,he),[[r,t.name]])]),l("div",null,[e[40]||(e[40]=l("label",null,"ID/Passport",-1)),s(l("input",{"onUpdate:modelValue":a=>t.id_proof=a,class:"input-field"},null,8,Ne),[[r,t.id_proof]])]),l("div",null,[e[41]||(e[41]=l("label",null,"Date of Birth",-1)),s(l("input",{"onUpdate:modelValue":a=>t.dob=a,type:"date",class:"input-field"},null,8,Ge),[[r,t.dob]])]),l("div",null,[e[42]||(e[42]=l("label",null,"Nationality",-1)),O(Y(H),{modelValue:t.nationality_id,"onUpdate:modelValue":a=>t.nationality_id=a,options:N.value,searchable:!0,loading:V.value,placeholder:"Country",class:"multiselect"},null,8,["modelValue","onUpdate:modelValue","options","loading"])]),l("button",{type:"button",onClick:a=>Q(C),class:"text-red-600 flex items-center"},e[43]||(e[43]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})],-1)]),8,Se)]))),128)),l("button",{type:"button",onClick:e[14]||(e[14]=t=>K()),class:"text-blue-600 hover:underline"}," + Add Guest ")]),l("div",Be,[l("div",null,[e[46]||(e[46]=l("label",{class:"block font-medium mb-1"},"Status",-1)),s(l("select",{"onUpdate:modelValue":e[15]||(e[15]=t=>o.value.status=t),class:"input-field"},e[45]||(e[45]=[l("option",{value:"pending"},"Pending",-1),l("option",{value:"confirmed"},"Confirmed",-1),l("option",{value:"cancelled"},"Cancelled",-1)]),512),[[D,o.value.status]])]),l("div",null,[e[47]||(e[47]=l("label",null,"Arr Flight/Hotel",-1)),s(l("input",{"onUpdate:modelValue":e[16]||(e[16]=t=>o.value.arrival_flight=t),class:"input-field"},null,512),[[r,o.value.arrival_flight]])]),l("div",null,[e[48]||(e[48]=l("label",null,"Dep Flight/Hotel",-1)),s(l("input",{"onUpdate:modelValue":e[17]||(e[17]=t=>o.value.departure_flight=t),class:"input-field"},null,512),[[r,o.value.departure_flight]])])]),l("div",null,[e[49]||(e[49]=l("label",{class:"block font-medium mb-1"},"Special Requests",-1)),s(l("textarea",{"onUpdate:modelValue":e[18]||(e[18]=t=>o.value.special_request=t),rows:"4",class:"input-field",placeholder:"Any special requests, notes, or instructions..."},null,512),[[r,o.value.special_request]])]),l("div",Ae,[l("button",{type:"submit",class:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg",disabled:J.value}," Update Booking ",8,Fe)])],32)])]),_:1}))}},je=ee(Ie,[["__scopeId","data-v-fea5524c"]]);export{je as default};
