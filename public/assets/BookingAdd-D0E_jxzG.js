import{_ as me,r as d,c as D,o as ce,d as h,C as ge,a as ve,w as pe,b as fe,u as be,f as a,g as o,p as ye,k as r,l as y,h as u,F as V,m as S,t as k,q as F,v as c,H as w,j as E,n as Z,I as ke,i as Q}from"./index-CfG8UM58.js";import{d as T,s as W}from"./dayjs.min-DOsEsJbi.js";import{d as _e}from"./index-BSTMtCd0.js";import"./_commonjsHelpers-DsqdWQfm.js";const xe={class:"p-4 max-w-4xl mx-auto bg-white shadow rounded-lg"},he={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},we={class:"md:col-span-2"},Ce=["value"],Ne={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Ve=["min"],Se=["min"],Ue={key:0,class:"text-sm text-gray-600 mt-10"},Ae={class:"font-medium"},Me={key:0},Re={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},De={class:"md:col-span-2"},Ie=["value"],Be={class:"p-2 grid grid-cols-1 md:grid-cols-1 gap-4 bg-gray-100 border-gray-300"},qe={class:""},Ge={key:0,class:"text-sm text-gray-500"},Pe={key:1,class:"border rounded-lg p-3"},Fe={key:0,class:"text-sm text-blue-600"},Ee={key:1},Te={key:0,class:"text-sm text-gray-500"},Le={class:"text-xs font-semibold text-gray-600 mb-2"},Oe={class:"grid grid-cols-6 sm:grid-cols-8 md:grid-cols-10 gap-2"},Ye=["onClick","disabled"],je={key:1,class:"mt-2 text-sm"},$e={class:"font-semibold"},He={key:0,class:"text-sm mb-2"},Ke={key:0,class:"text-green-600"},ze={key:1,class:"text-red-600"},Je={key:1,class:"flex items-center mb-4"},Ze={key:2,class:"text-blue-600 text-sm"},Qe={class:"mt-4 bg-gray-100 p-3"},We={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Xe={class:"mt-4 p-3 bg-gray-100"},eo=["onUpdate:modelValue"],oo=["onUpdate:modelValue"],to=["onUpdate:modelValue"],lo=["onClick"],so={class:"grid md:grid-cols-2 gap-4"},no={class:"grid md:grid-cols-1 gap-4"},ao={class:"grid md:grid-cols-3 gap-4"},io={key:3,class:"text-red-600"},ro={class:"flex justify-end"},uo=["disabled"],X="recent_countries_v1",mo={__name:"BookingAdd",setup(co){const ee=be(),L=d([]),O=d([]),Y=T().format("YYYY-MM-DD"),I=D(()=>!l.value.check_in||!l.value.check_out?0:T(l.value.check_out).diff(T(l.value.check_in),"day")),_=d([]),B=d(!1),j=D(()=>!!(l.value.room_type_id&&l.value.check_in&&l.value.check_out)),$=D(()=>{const n=Array.isArray(_.value)?_.value:[],e=new Map;for(const t of n){const s=t.floor??"-";e.has(s)||e.set(s,[]),e.get(s).push(t)}return Array.from(e.entries()).map(([t,s])=>({floor:t,rooms:s}))}),oe=n=>{const e=Number(l.value.room_inventory_id)===Number(n.id);return n.is_booked===1?"px-2 py-2 text-xs rounded bg-gray-200 text-gray-500 cursor-not-allowed":e?"px-2 py-2 text-xs rounded bg-green-600 text-white":"px-2 py-2 text-xs rounded bg-white border hover:bg-green-50"},U=d([]),A=d(!1),q=new Map,G=["China","Maldives","India","Sri Lanka","United Kingdom","United States","United Arab Emirates","Saudi Arabia","Germany","France","Italy","Russia","Singapore","Malaysia","Australia"],l=d({customer_id:"",customer_ref_no:"",room_type_id:"",room_inventory_id:"",check_in:"",check_out:"",guests:1,status:"pending",arrival_flight:"",departure_flight:"",special_request:""}),H=async(n="")=>{const e=(n||"").toLowerCase().trim();if(q.has(e)){U.value=q.get(e);return}A.value=!0;try{let s=((await h.get("countries",{params:{q:e}})).data||[]).map(v=>({value:Number(v.id),label:v.name}));if(!e){const v=new Set(G.map(m=>m.toLowerCase())),f=[],R=[];for(const m of s)v.has(String(m.label).toLowerCase())?f.push(m):R.push(m);f.sort((m,de)=>G.indexOf(m.label)-G.indexOf(de.label)),s=[...f,...R]}const i=z();if(i.length){const v=new Map(s.map(m=>[m.value,m])),f=i.map(m=>v.get(m)).filter(Boolean),R=new Set(f.map(m=>m.value));s=[...f,...s.filter(m=>!R.has(m.value))]}q.set(e,s),U.value=s}finally{A.value=!1}},K=_e(n=>H(n),250),g=d({name:"",contact:"",email:"",dob:"",idProof:"",nationality_id:null}),M=d([]),te=()=>{M.value.push({name:"",contact:"",email:"",dob:"",idProof:"",nationality_id:null})},le=n=>{M.value.splice(n,1)},p=d(""),C=d(!1),b=d(null),N=d(!1),x=d(!1);d(!1);const se=d([]),ne=d(new Set);D(()=>{const n=(se.value||[]).map(s=>{const i=Number(s.id);return{...s,id:i,floor:s.floor??"-",room_number:s.room_number??s.room_no??s.roomNo??s.room,is_available:ne.value.has(i)}}),e=new Map;for(const s of n){const i=String(s.floor??"-");e.has(i)||e.set(i,[]),e.get(i).push(s)}const t=Array.from(e.keys()).sort((s,i)=>{const v=Number(s),f=Number(i);return!Number.isNaN(v)&&!Number.isNaN(f)?v-f:s.localeCompare(i)});for(const s of t)e.get(s).sort((i,v)=>String(i.room_number).localeCompare(String(v.room_number),void 0,{numeric:!0}));return t.map(s=>({floor:s,rooms:e.get(s)}))});const z=()=>{try{return JSON.parse(localStorage.getItem(X)||"[]")}catch{return[]}},J=n=>{if(!n)return;const e=z().filter(t=>t!==n);e.unshift(n),localStorage.setItem(X,JSON.stringify(e.slice(0,8)))};ce(async()=>{const[n,e]=await Promise.all([h.get("customers"),h.get("roomtypes")]);await H(""),L.value=n.data,O.value=e.data});const ae=n=>{n.is_booked!==1&&(l.value.room_inventory_id=n.id)},ie=async()=>{if(!j.value){_.value=[];return}B.value=!0;try{const n=await h.get("availability/room-map",{params:{room_type_id:l.value.room_type_id,check_in:l.value.check_in,check_out:l.value.check_out}});_.value=Array.isArray(n.data?.rooms)?n.data.rooms:[]}finally{B.value=!1}};ge(()=>{const n=l.value||{};return[n.room_type_id??"",n.check_in??"",n.check_out??""]},async([n,e,t])=>{if(l.value.room_inventory_id="",!n||!e||!t){_.value=[];return}if(new Date(t)<=new Date(e)){_.value=[];return}await ie(),await P()},{immediate:!1});const re=()=>{if(!l.value.customer_id||!l.value.room_type_id||!l.value.check_in||!l.value.check_out)return p.value="All required fields must be filled.",!1;const n=new Date(l.value.check_in);return new Date(l.value.check_out)<=n?(p.value="Check-out date must be after check-in date.",!1):l.value.guests<1?(p.value="At least one guest is required.",!1):!0},P=async()=>{C.value=!0;try{const{data:n}=await h.get("availability/check",{params:{room_type_id:l.value.room_type_id,check_in:l.value.check_in,check_out:l.value.check_out}});b.value=n.available_rooms,N.value=!0}catch{b.value=0,N.value=!0}finally{C.value=!1}},ue=async()=>{if(p.value="",!!re()){if(await P(),N.value||await P(),b.value<1&&!x.value){p.value='No rooms available. To proceed, check "Allow overbooking".';return}try{const n={...l.value,primaryGuest:g.value,extraGuests:M.value,overbook:x.value},e=await h.post("bookings",n);e.data.status==="success"?ee.push("/bookings"):p.value=e.data.message||"Failed to save booking."}catch(n){p.value=n.response?.data?.message||"Server error."}}};return(n,e)=>(a(),ve(fe,null,{default:pe(()=>[o("div",xe,[e[49]||(e[49]=o("h2",{class:"text-xl font-semibold mb-6 flex items-center border-b"},"Add Booking",-1)),o("form",{onSubmit:ye(ue,["prevent"]),class:"space-y-6 bg-white p-3 rounded-xl"},[o("div",he,[o("div",we,[e[19]||(e[19]=o("label",{class:"block font-medium mb-1"},"Customer/Agent *",-1)),u(o("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.customer_id=t),class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500",required:""},[e[18]||(e[18]=o("option",{disabled:"",value:""},"Select a customer",-1)),(a(!0),r(V,null,S(L.value,t=>(a(),r("option",{key:t.id,value:t.id},k(t.name),9,Ce))),128))],512),[[F,l.value.customer_id]])]),o("div",null,[e[20]||(e[20]=o("label",{class:"block font-medium mb-1"},"Agent Ref No",-1)),u(o("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.customer_ref_no=t),type:"text",class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Enter agent reference number"},null,512),[[c,l.value.customer_ref_no]])])]),o("div",Ne,[o("div",null,[e[21]||(e[21]=o("label",{class:"block font-medium mb-1"},"Check-In *",-1)),u(o("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.check_in=t),type:"date",min:w(Y),class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500",required:""},null,8,Ve),[[c,l.value.check_in]])]),o("div",null,[e[22]||(e[22]=o("label",{class:"block font-medium mb-1"},"Check-Out *",-1)),u(o("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.check_out=t),type:"date",class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500",required:"",min:l.value.check_in||w(Y)},null,8,Se),[[c,l.value.check_out]])]),I.value>0?(a(),r("div",Ue,[e[23]||(e[23]=E(" üõèÔ∏è ")),o("span",Ae,k(I.value),1),e[24]||(e[24]=E(" Night")),I.value>1?(a(),r("span",Me,"s")):y("",!0)])):y("",!0)]),o("div",Re,[o("div",null,[e[25]||(e[25]=o("label",{class:"block font-medium mb-1"},"No of Guests",-1)),u(o("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.guests=t),type:"number",min:"1",class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500"},null,512),[[c,l.value.guests,void 0,{number:!0}]])]),o("div",De,[e[27]||(e[27]=o("label",{class:"block font-medium mb-1"},"Room Type *",-1)),u(o("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.room_type_id=t),class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500",required:""},[e[26]||(e[26]=o("option",{disabled:"",value:""},"Select a room type",-1)),(a(!0),r(V,null,S(O.value,t=>(a(),r("option",{key:t.id,value:t.id},k(t.name),9,Ie))),128))],512),[[F,l.value.room_type_id]])])]),o("div",Be,[o("div",qe,[e[29]||(e[29]=o("label",{class:"block font-medium mb-1"},"Room Assignment",-1)),j.value?(a(),r("div",Pe,[B.value?(a(),r("div",Fe,"Loading rooms...")):(a(),r("div",Ee,[$.value.length===0?(a(),r("div",Te," No rooms found for this room type. ")):y("",!0),(a(!0),r(V,null,S($.value,t=>(a(),r("div",{key:t.floor,class:"mb-4"},[o("div",Le," Floor "+k(t.floor),1),o("div",Oe,[(a(!0),r(V,null,S(t.rooms,s=>(a(),r("button",{key:s.id,type:"button",onClick:i=>ae(s),disabled:s.is_booked===1,class:Z(oe(s))},k(s.room_number),11,Ye))),128))])]))),128)),l.value.room_inventory_id?(a(),r("div",je,[e[28]||(e[28]=E(" Selected room ID: ")),o("span",$e,k(l.value.room_inventory_id),1)])):y("",!0)]))])):(a(),r("div",Ge," Select Room Type + Check-in + Check-out to load rooms. "))])]),N.value?(a(),r("div",He,[b.value>0?(a(),r("span",Ke," ‚úîÔ∏è "+k(b.value)+" room(s) available ",1)):(a(),r("span",ze," ‚ö†Ô∏è No rooms available for these dates. "))])):y("",!0),N.value&&b.value<1?(a(),r("div",Je,[u(o("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=t=>x.value=t),id:"overbook",class:"mr-2"},null,512),[[ke,x.value]]),e[30]||(e[30]=o("label",{for:"overbook",class:"text-gray-700"}," Confirm allowing overbooking ",-1))])):y("",!0),C.value?(a(),r("div",Ze," Checking availability... ")):y("",!0),o("div",Qe,[e[37]||(e[37]=o("h3",{class:"font-semibold mb-2"},"Primary Guest Details",-1)),o("div",We,[o("div",null,[e[31]||(e[31]=o("label",null,"Name *",-1)),u(o("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>g.value.name=t),class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500",required:""},null,512),[[c,g.value.name]])]),o("div",null,[e[32]||(e[32]=o("label",null,"Contact ",-1)),u(o("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>g.value.contact=t),class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500"},null,512),[[c,g.value.contact]])]),o("div",null,[e[33]||(e[33]=o("label",null,"Email",-1)),u(o("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>g.value.email=t),class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500"},null,512),[[c,g.value.email]])]),o("div",null,[e[34]||(e[34]=o("label",null,"ID/Passport No",-1)),u(o("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>g.value.idProof=t),class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500"},null,512),[[c,g.value.idProof]])]),o("div",null,[e[35]||(e[35]=o("label",null,"Date of Birth ",-1)),u(o("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>g.value.dob=t),type:"date",class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500"},null,512),[[c,g.value.dob]])]),o("div",null,[e[36]||(e[36]=o("label",{class:"block font-medium mb-1"},"Country / Nationality",-1)),Q(w(W),{modelValue:g.value.nationality_id,"onUpdate:modelValue":[e[12]||(e[12]=t=>g.value.nationality_id=t),J],options:U.value,searchable:!0,loading:A.value,placeholder:"country...",onSearchChange:w(K)},null,8,["modelValue","options","loading","onSearchChange"])])])]),o("div",Xe,[e[43]||(e[43]=o("h3",{class:"font-semibold mb-2"},"Additional Guests",-1)),(a(!0),r(V,null,S(M.value,(t,s)=>(a(),r("div",{key:s,class:"grid gap-4 md:grid-cols-[3fr_1fr_2fr_2fr] items-end mb-4"},[o("div",null,[e[38]||(e[38]=o("label",null,"Name",-1)),u(o("input",{"onUpdate:modelValue":i=>t.name=i,class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500"},null,8,eo),[[c,t.name]])]),o("div",null,[e[39]||(e[39]=o("label",null,"Date of Birth",-1)),u(o("input",{"onUpdate:modelValue":i=>t.dob=i,type:"date",class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500"},null,8,oo),[[c,t.dob]])]),o("div",null,[e[40]||(e[40]=o("label",null,"ID/Passport No",-1)),u(o("input",{"onUpdate:modelValue":i=>t.idProof=i,class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500"},null,8,to),[[c,t.idProof]])]),o("div",null,[e[41]||(e[41]=o("label",{class:"block font-medium mb-1"},"Country / Nationality",-1)),Q(w(W),{modelValue:t.nationality_id,"onUpdate:modelValue":[i=>t.nationality_id=i,J],options:U.value,searchable:!0,loading:A.value,placeholder:" country...",onSearchChange:w(K)},null,8,["modelValue","onUpdate:modelValue","options","loading","onSearchChange"])]),o("button",{type:"button",onClick:i=>le(s),class:"text-red-600"},e[42]||(e[42]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})],-1)]),8,lo)]))),128)),o("button",{type:"button",onClick:e[13]||(e[13]=t=>te()),class:"text-blue-600 hover:underline"}," + Add Guest ")]),o("div",so,[o("div",no,[o("div",null,[e[44]||(e[44]=o("label",{class:"block font-medium mb-1"},"Arr Flight / Hotel",-1)),u(o("input",{"onUpdate:modelValue":e[14]||(e[14]=t=>l.value.arrival_flight=t),type:"text",class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500"},null,512),[[c,l.value.arrival_flight]])]),o("div",null,[e[45]||(e[45]=o("label",{class:"block font-medium mb-1"},"Dep Flight / Hotel",-1)),u(o("input",{"onUpdate:modelValue":e[15]||(e[15]=t=>l.value.departure_flight=t),type:"text",class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500"},null,512),[[c,l.value.departure_flight]])])]),o("div",null,[e[46]||(e[46]=o("label",{class:"block font-medium mb-1"},"Remarks",-1)),u(o("textarea",{"onUpdate:modelValue":e[16]||(e[16]=t=>l.value.special_request=t),rows:"4",class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Enter remarks / special notes..."},null,512),[[c,l.value.special_request]])])]),o("div",ao,[o("div",null,[e[48]||(e[48]=o("label",{class:"block font-medium mb-1"},"Status",-1)),u(o("select",{"onUpdate:modelValue":e[17]||(e[17]=t=>l.value.status=t),class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-1 focus:ring-indigo-500"},e[47]||(e[47]=[o("option",{value:"pending"},"Pending",-1),o("option",{value:"confirmed"},"Confirmed",-1),o("option",{value:"cancelled"},"Cancelled",-1)]),512),[[F,l.value.status]])])]),p.value?(a(),r("p",io,k(p.value),1)):y("",!0),o("div",ro,[o("button",{type:"submit",class:Z(["px-6 py-2 rounded-lg",[C.value||b.value<1&&!x.value?"bg-gray-300 text-gray-50":"bg-blue-700 text-blue-50 hover:bg-blue-300"]]),disabled:C.value||b.value<1&&!x.value}," Save Booking ",10,uo)])],32)])]),_:1}))}},bo=me(mo,[["__scopeId","data-v-dbdbeeef"]]);export{bo as default};
