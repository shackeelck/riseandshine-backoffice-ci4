import{_ as C,r as m,o as q,d as g,c as D,a as S,w as h,b as B,u as I,f as u,g as e,h as s,k as i,F as b,m as v,t as d,q as f,v as r,j as M,I as P}from"./index-Dv5Rhcvw.js";const R={class:"p-6 max-w-4xl mx-auto bg-white shadow rounded"},T={class:"grid md:grid-cols-5 gap-4 mb-2"},A={class:"md:col-span-2"},E=["value"],F={class:"mb-4"},$=["value"],j={class:"w-full text-sm border"},N=["onUpdate:modelValue"],L=["onUpdate:modelValue"],O=["onUpdate:modelValue"],z=["onUpdate:modelValue"],G={class:"text-right"},H=["onClick"],J={class:"text-right mt-4 font-bold"},K={__name:"ProformaAdd",setup(Q){const k=I(),y=m([]),_=m([]),l=m({customer_id:"",invoice_date:new Date().toISOString().slice(0,10),due_date:"",currency:"USD",bookings:[],items:[{description:"",qty:1,unit_type:"per_booking",unit_price:0}]});q(async()=>{y.value=(await g.get("customers")).data});const x=async()=>{_.value=(await g.get(`customers/${l.value.customer_id}/bookings/uninvoiced`)).data},U=()=>l.value.items.push({description:"",qty:1,unit_type:"per_booking",unit_price:0}),V=a=>l.value.items.splice(a,1),c=D(()=>l.value.items.reduce((a,t)=>a+t.qty*t.unit_price,0).toFixed(2)),w=async()=>{const a={...l.value,subtotal:c.value,total:c.value};(await g.post("proforma",a)).data.status==="success"&&k.push("/proformas")};return(a,t)=>(u(),S(B,null,{default:h(()=>[e("div",R,[t[14]||(t[14]=e("h2",{class:"text-xl font-bold mb-4"},"Create Proforma",-1)),e("div",T,[e("div",A,[t[6]||(t[6]=e("label",{class:"block font-medium mb-1"},"Customer *",-1)),s(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>l.value.customer_id=o),class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500",onChange:x,required:""},[t[5]||(t[5]=e("option",{value:""},"Select Customer",-1)),(u(!0),i(b,null,v(y.value,o=>(u(),i("option",{key:o.id,value:o.id},d(o.name),9,E))),128))],544),[[f,l.value.customer_id]])]),e("div",null,[t[7]||(t[7]=e("label",{class:"block font-medium mb-1"},"Invoice Date *",-1)),s(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=o=>l.value.invoice_date=o),class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500",required:""},null,512),[[r,l.value.invoice_date]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"block font-medium mb-1"},"Due Date",-1)),s(e("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=o=>l.value.due_date=o),class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500"},null,512),[[r,l.value.due_date]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block font-medium mb-1"},"Currency",-1)),s(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>l.value.currency=o),class:"input-field bg-gray-50 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500",required:""},t[9]||(t[9]=[e("option",{value:"USD"},"USD",-1),e("option",{value:"MVR"},"MVR",-1),e("option",{value:"EUR"},"EUR",-1)]),512),[[f,l.value.currency]])])]),e("div",F,[t[11]||(t[11]=e("label",{class:"font-medium"},"Bookings",-1)),(u(!0),i(b,null,v(_.value,o=>(u(),i("div",{key:o.id},[e("label",null,[s(e("input",{type:"checkbox",value:o.id,"onUpdate:modelValue":t[4]||(t[4]=p=>l.value.bookings=p)},null,8,$),[[P,l.value.bookings]]),M(" "+d(o.reference)+" ("+d(o.check_in)+" → "+d(o.check_out)+") ",1)])]))),128))]),t[15]||(t[15]=e("h3",{class:"font-semibold mb-2"},"Particulars",-1)),e("table",j,[t[13]||(t[13]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"p-2"},"Description"),e("th",{class:"p-2"},"Unit Price"),e("th",{class:"p-2"},"Units"),e("th",{class:"p-2"},"Unit Type"),e("th",{class:"p-2"},"Total"),e("th")])],-1)),e("tbody",null,[(u(!0),i(b,null,v(l.value.items,(o,p)=>(u(),i("tr",{key:p},[e("td",null,[s(e("input",{"onUpdate:modelValue":n=>o.description=n,class:"input-field bg-gray-50 border-gray-300"},null,8,N),[[r,o.description]])]),e("td",null,[s(e("input",{type:"text","onUpdate:modelValue":n=>o.unit_price=n,class:"input-field bg-gray-50 border-gray-300"},null,8,L),[[r,o.unit_price,void 0,{number:!0}]])]),e("td",null,[s(e("input",{type:"number","onUpdate:modelValue":n=>o.qty=n,class:"input-field bg-gray-50 border-gray-300"},null,8,O),[[r,o.qty,void 0,{number:!0}]])]),e("td",null,[s(e("select",{"onUpdate:modelValue":n=>o.unit_type=n,class:"input-field bg-gray-50 border-gray-300"},t[12]||(t[12]=[e("option",null,"per_booking",-1),e("option",null,"per_night",-1),e("option",null,"per_pax",-1)]),8,z),[[f,o.unit_type]])]),e("td",G,d(o.qty*o.unit_price),1),e("td",null,[e("button",{onClick:n=>V(p)},"✕",8,H)])]))),128))])]),e("button",{onClick:U,class:"mt-2 text-blue-600"},"+ Add Item"),e("div",J,"Total: "+d(c.value),1),e("div",{class:"flex justify-end"},[e("button",{onClick:w,class:"px-6 py-2 rounded-lg bg-blue-700 text-blue-50 hover:bg-blue-300"},"Save Proforma")])])]),_:1}))}},X=C(K,[["__scopeId","data-v-cc3cd121"]]);export{X as default};
