import{s as q,r as d,c as N,o as S,d as f,a as U,w,b as $,u as A,e as F,f as l,g as e,k as i,l as G,i as L,j as c,t as n,F as v,m as b,n as P,h as C,I as T,v as E}from"./index-CfG8UM58.js";const z={class:"p-6 max-w-6xl mx-auto space-y-6"},O={class:"flex justify-between items-center"},Q={class:"grid md:grid-cols-2 gap-6"},Y={class:"bg-white shadow rounded-lg p-6"},H={class:"space-y-2 text-sm"},J={class:"bg-white shadow rounded-lg p-6"},K={class:"font-semibold"},W={class:"text-gray-500"},X={class:"mt-2"},Z=["onChange"],ee={class:"bg-white shadow rounded-lg p-6"},te={class:"grid grid-cols-4 md:grid-cols-6 gap-3"},se=["onClick","disabled"],oe={class:"grid md:grid-cols-2 gap-6"},ne={class:"bg-white shadow rounded-lg p-6"},ae=["onUpdate:modelValue"],le={class:"bg-white shadow rounded-lg p-6"},ie={class:"w-full text-sm"},de={class:"p-2"},re={class:"p-2 text-center"},ue=["onUpdate:modelValue"],ce={key:0,class:"text-red-600"},ve={__name:"Checkin",setup(me){const D=q(),B=A(),h=D.params.id,a=d({}),k=d([]),y=d([]),g=d([]),_=d([]),u=d(null),m=d(""),V=N(()=>{if(!a.value.check_in||!a.value.check_out)return 0;const o=new Date(a.value.check_in),t=new Date(a.value.check_out);return Math.round((t-o)/864e5)}),x=o=>o?new Date(o).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"-",I=o=>o.id===a.value.room_inventory_id?"p-3 rounded bg-yellow-400 text-black border font-semibold":o.status==="occupied"?"p-3 rounded bg-red-200 text-red-800 cursor-not-allowed":u.value===o.id?"p-3 rounded bg-blue-500 text-white":"p-3 rounded bg-green-100 hover:bg-green-200",R=o=>{o.status!=="occupied"&&(u.value=o.id)},M=async(o,t)=>{const p=o.target.files[0];if(!p)return;const s=new FormData;s.append("file",p),s.append("guest_id",t.id),await f.post("frontdesk/upload-passport",s)};S(async()=>{const o=await f.get(`frontdesk/checkin/${h}`);a.value=o.data.booking,k.value=o.data.guests,y.value=o.data.rooms,g.value=o.data.minibar.map(t=>({...t,quantity:0})),_.value=o.data.amenities.map(t=>({...t,assigned:!1})),u.value=a.value.room_inventory_id});const j=async()=>{if(m.value="",!u.value){m.value="Please select a room before check-in.";return}await f.post(`frontdesk/checkin/${h}`,{room_inventory_id:u.value,minibar:g.value.filter(o=>o.quantity>0),amenities:_.value.filter(o=>o.assigned)}),B.push("/bookings")};return(o,t)=>{const p=F("router-link");return l(),U($,null,{default:w(()=>[e("div",z,[e("div",O,[t[1]||(t[1]=e("h2",{class:"text-2xl font-bold"},"Guest Check-In",-1)),L(p,{to:"/bookings",class:"bg-gray-200 px-4 py-2 rounded hover:bg-gray-300"},{default:w(()=>t[0]||(t[0]=[c(" Back ")])),_:1,__:[0]})]),e("div",Q,[e("div",Y,[t[6]||(t[6]=e("h3",{class:"font-semibold mb-4 text-lg"},"Booking Details",-1)),e("div",H,[e("div",null,[t[2]||(t[2]=e("b",null,"Agent:",-1)),c(" "+n(a.value.customer_name),1)]),e("div",null,[t[3]||(t[3]=e("b",null,"Room Type:",-1)),c(" "+n(a.value.room_type),1)]),e("div",null,[t[4]||(t[4]=e("b",null,"Stay:",-1)),c(" "+n(x(a.value.check_in))+" â†’ "+n(x(a.value.check_out))+" ("+n(V.value)+" nights) ",1)]),e("div",null,[t[5]||(t[5]=e("b",null,"Status:",-1)),c(" "+n(a.value.status),1)])])]),e("div",J,[t[8]||(t[8]=e("h3",{class:"font-semibold mb-4 text-lg"},"Guest Details",-1)),(l(!0),i(v,null,b(k.value,s=>(l(),i("div",{key:s.id,class:"border rounded p-3 mb-3 text-sm"},[e("div",K,n(s.name),1),e("div",W,n(s.guest_country||"")+" | ID: "+n(s.id_proof)+" | DOB: "+n(s.dob)+" |Contact: "+n(s.contact)+" | Email: "+n(s.email),1),e("div",X,[t[7]||(t[7]=e("label",{class:"block text-xs mb-1"},"Passport Copy",-1)),e("input",{type:"file",onChange:r=>M(r,s),class:"text-xs"},null,40,Z)])]))),128))])]),e("div",ee,[t[9]||(t[9]=e("h3",{class:"font-semibold mb-4 text-lg"},"Room Assignment",-1)),e("div",te,[(l(!0),i(v,null,b(y.value,s=>(l(),i("button",{key:s.id,onClick:r=>R(s),class:P(I(s)),disabled:s.status==="occupied"},n(s.room_number),11,se))),128))])]),e("div",oe,[e("div",ne,[t[10]||(t[10]=e("h3",{class:"font-semibold mb-4 text-lg"},"Room Amenities ",-1)),(l(!0),i(v,null,b(_.value,s=>(l(),i("div",{key:s.id,class:"flex justify-between items-center mb-2"},[e("span",null,n(s.name),1),C(e("input",{type:"checkbox","onUpdate:modelValue":r=>s.assigned=r},null,8,ae),[[T,s.assigned]])]))),128))]),e("div",le,[t[12]||(t[12]=e("h3",{class:"font-semibold mb-4 text-lg"},"Minibar Items Loaded",-1)),e("table",ie,[t[11]||(t[11]=e("thead",null,[e("tr",{class:"bg-gray-100"},[e("th",{class:"p-2 text-left"},"Item"),e("th",{class:"p-2 text-center"},"Qty")])],-1)),e("tbody",null,[(l(!0),i(v,null,b(g.value,s=>(l(),i("tr",{key:s.id},[e("td",de,n(s.name),1),e("td",re,[C(e("input",{type:"number",min:"0","onUpdate:modelValue":r=>s.quantity=r,class:"w-16 border rounded text-center"},null,8,ue),[[E,s.quantity,void 0,{number:!0}]])])]))),128))])])])]),m.value?(l(),i("div",ce,n(m.value),1)):G("",!0),e("div",{class:"flex justify-end"},[e("button",{onClick:j,class:"bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700"}," Confirm Check-In ")])])]),_:1})}}};export{ve as default};
