import{r as i,o as N,a as j,w as E,b as F,d as D,f as l,g as e,k as a,l as m,h as C,v as U,q,j as p,t as d,F as v,m as b,n as z}from"./index-CfG8UM58.js";const P={class:"p-6"},G={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4"},H={class:"flex items-center gap-2"},Y={key:0,class:"text-red-600 mb-3"},J={class:"font-semibold mb-2"},K={class:"overflow-auto bg-white border rounded-lg shadow-sm"},Q={class:"min-w-[1000px] w-full border-collapse"},W={class:"bg-gray-100"},X={class:"border p-2 font-medium"},Z=["title","onClick"],ee={key:0},te={key:0},se=["colspan"],oe={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4"},le={class:"w-full max-w-3xl bg-white rounded-lg shadow-lg overflow-hidden"},ae={class:"px-4 py-3 border-b flex items-center justify-between"},ne={class:"font-semibold"},re={class:"p-4"},de={key:0,class:"text-sm text-blue-600"},ie={key:1},ce={key:0,class:"text-gray-500 text-sm"},ue={key:1,class:"overflow-auto"},pe={class:"w-full border-collapse text-sm"},ve={class:"border p-2"},be={class:"border p-2"},he={class:"border p-2"},me={class:"border p-2"},_e={class:"border p-2"},xe={class:"border p-2"},ge={class:"border p-2"},ke={__name:"AvailabilityChart",setup(ye){const _=i(new Date().toISOString().slice(0,7)),x=i(4),g=i(2),y=i([]),S=i([]),T=i([]),h=i(""),M=async()=>{h.value="";try{const n=`${_.value}-01`,t=await D.get("availabilitychart",{params:{from:n,months:x.value,on_request_threshold:g.value}});y.value=t.data.room_types||[],S.value=t.data.months||[],T.value=t.data.chart||[]}catch(n){h.value=n.response?.data?.message||"Failed to load chart"}},f=(n,t,s)=>T.value?.[n]?.[t]?.[s]||null,O=(n,t,s)=>f(n,t,s)?.status||"open",V=(n,t,s)=>{const o=O(n,t,s);return o==="stop"||o==="new_stop"},$=(n,t,s)=>{const o=O(n,t,s);return{"bg-white":o==="open","bg-yellow-200":o==="on_request","bg-yellow-400":o==="stop","bg-red-500 text-white":o==="new_stop","bg-green-500 text-white":o==="reopen"}},L=(n,t,s)=>{const o=f(n,t,s);return o?`Date: ${o.date}
Total: ${o.total}
Booked: ${o.booked}
Available: ${o.available}
Status: ${o.status}`:""},w=i(!1),k=i(!1),c=i([]),A=i(""),B=i(null),R=async(n,t,s)=>{const o=f(n,t.id,s);if(o?.date){A.value=o.date,B.value=t,c.value=[],w.value=!0,k.value=!0;try{const r=await D.get("availabilitychart/details",{params:{date:o.date,room_type_id:t.id}});c.value=r.data.bookings||[]}catch{c.value=[]}finally{k.value=!1}}},I=()=>{w.value=!1};return N(M),(n,t)=>(l(),j(F,null,{default:E(()=>[e("div",P,[e("div",G,[t[5]||(t[5]=e("h2",{class:"text-xl font-bold"},"STOP SALES & ROOM AVAILABILITY ADVISE CHART",-1)),e("div",H,[C(e("input",{type:"month","onUpdate:modelValue":t[0]||(t[0]=s=>_.value=s),class:"border rounded px-3 py-2"},null,512),[[U,_.value]]),C(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>x.value=s),class:"border rounded px-3 py-2"},t[3]||(t[3]=[e("option",{value:1},"1 Month",-1),e("option",{value:2},"2 Months",-1),e("option",{value:3},"3 Months",-1),e("option",{value:4},"4 Months",-1)]),512),[[q,x.value,void 0,{number:!0}]]),C(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>g.value=s),class:"border rounded px-3 py-2"},t[4]||(t[4]=[e("option",{value:1},"On request ≤ 1",-1),e("option",{value:2},"On request ≤ 2",-1),e("option",{value:3},"On request ≤ 3",-1)]),512),[[q,g.value,void 0,{number:!0}]]),e("button",{onClick:M,class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"}," Load ")])]),t[10]||(t[10]=e("div",{class:"flex flex-wrap gap-3 text-sm mb-4"},[e("div",{class:"flex items-center gap-2"},[e("span",{class:"w-4 h-4 border bg-white inline-block"}),p(" Open")]),e("div",{class:"flex items-center gap-2"},[e("span",{class:"w-4 h-4 inline-block bg-yellow-400"}),p(" Stop sales")]),e("div",{class:"flex items-center gap-2"},[e("span",{class:"w-4 h-4 inline-block bg-red-500"}),p(" New stop sales")]),e("div",{class:"flex items-center gap-2"},[e("span",{class:"w-4 h-4 inline-block bg-green-500"}),p(" Re-open")]),e("div",{class:"flex items-center gap-2"},[e("span",{class:"w-4 h-4 inline-block bg-yellow-200"}),p(" On request")])],-1)),h.value?(l(),a("div",Y,d(h.value),1)):m("",!0),(l(!0),a(v,null,b(S.value,(s,o)=>(l(),a("div",{key:s.start,class:"mb-10"},[e("div",J,d(s.month),1),e("div",K,[e("table",Q,[e("thead",W,[e("tr",null,[t[6]||(t[6]=e("th",{class:"border p-2 text-left w-64"},"Date",-1)),(l(!0),a(v,null,b(s.days,r=>(l(),a("th",{key:r,class:"border p-1 text-center text-xs w-8"},d(r),1))),128))])]),e("tbody",null,[(l(!0),a(v,null,b(y.value,r=>(l(),a("tr",{key:r.id},[e("td",X,d(r.name),1),(l(!0),a(v,null,b(s.days,u=>(l(),a("td",{key:r.id+"-"+u,class:"border p-0"},[e("button",{type:"button",class:z(["h-8 w-full flex items-center justify-center text-[11px] select-none",$(o,r.id,u)]),title:L(o,r.id,u),onClick:fe=>R(o,r,u)},[V(o,r.id,u)?(l(),a("span",ee,"x")):m("",!0)],10,Z)]))),128))]))),128)),y.value.length===0?(l(),a("tr",te,[e("td",{class:"p-4 text-center text-gray-500",colspan:s.days+1}," No room types found ",8,se)])):m("",!0)])])]),t[7]||(t[7]=e("div",{class:"text-xs text-gray-500 mt-2"}," Click any cell to view bookings for that room type & date. ",-1))]))),128)),w.value?(l(),a("div",oe,[e("div",le,[e("div",ae,[e("div",ne," Bookings: "+d(B.value?.name)+" — "+d(A.value),1),e("button",{onClick:I,class:"px-3 py-1 rounded bg-gray-100 hover:bg-gray-200"},"Close")]),e("div",re,[k.value?(l(),a("div",de,"Loading...")):(l(),a("div",ie,[c.value.length===0?(l(),a("div",ce," No bookings for this date. ")):(l(),a("div",ue,[e("table",pe,[t[8]||(t[8]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"border p-2 text-left"},"Ref"),e("th",{class:"border p-2 text-left"},"Primary Guest"),e("th",{class:"border p-2 text-left"},"Customer/Agent"),e("th",{class:"border p-2 text-left"},"Room"),e("th",{class:"border p-2 text-left"},"Check-In"),e("th",{class:"border p-2 text-left"},"Check-Out"),e("th",{class:"border p-2 text-left"},"Status")])],-1)),e("tbody",null,[(l(!0),a(v,null,b(c.value,s=>(l(),a("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",ve,d(s.reference),1),e("td",be,d(s.primary_guest_name||"-"),1),e("td",he,d(s.customer_name||"-"),1),e("td",me,d(s.room_number||"-"),1),e("td",_e,d(s.check_in),1),e("td",xe,d(s.check_out),1),e("td",ge,d(s.status),1)]))),128))])])]))]))]),t[9]||(t[9]=e("div",{class:"px-4 py-3 border-t text-xs text-gray-500"}," Tip: This list includes bookings where check_in ≤ date & check_out > date. ",-1))])])):m("",!0)])]),_:1}))}};export{ke as default};
